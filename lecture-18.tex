% !TEX spellcheck = en_US
% !TEX spellcheck = LaTeX
\documentclass[a4paper,10pt,english]{article}
\input{header}
\title{Lecture 18 : Martingales}
\author{}
\begin{document}
\maketitle
\section{Martingales}
A martingale is a type of stochastic process whose definition formalizes the concept of a fair game.
\begin{defn}
A stochastic process $\{Z_n,~n \geq 1\}$ is said to be a martingale process if 
\begin{enumerate}
\item $E[|Z_n|]< \infty$, ~ \text{for all}~ n.
\item $E[Z_{n+1}|Z_1,Z_2, \hdots Z_n]=Z_n$.
\end{enumerate}
\end{defn}
Taking expectation on both sides of part 2 of the above definition, we get
\begin{equation*}
E[Z_{n+1}]=E[Z_n],
\end{equation*}
and so 
\begin{equation*}
E[Z_{n+1}]=E[Z_1],~ \text{for all} ~ n.
\end{equation*}
\begin{exmp}
Let $\{X_i\}$ be a sequence of independent random variables with mean $0$. Let $Z_n=\sum_{i=1}^n X_i$. Then, $\{Z_n,~n \geq 1\}$ is a martingale. This is so because, $E[Z_n]=0$ and 
\begin{flalign*}
E[Z_{n+1}|Z_1,Z_2 \hdots Z_n]&=E[Z_{n}+X_{n+1}|Z_1,Z_2 \hdots Z_n]\\
&=E[Z_{n}|Z_1,Z_2 \hdots Z_n]+E[X_{n+1}|Z_1,Z_2 \hdots Z_n]\\
&=Z_n.
\end{flalign*} 
\end{exmp}
\begin{exmp}
Let $\{X_i\}$ be a sequence of independent random variables with mean $1$. Let $Z_n=\Pi_{i=1}^n X_i$. Then, $\{Z_n,~n \geq 1\}$ is a martingale. This is so because, $E[Z_n]=1$ and 
\begin{flalign*}
E[Z_{n+1}|Z_1,Z_2 \hdots Z_n]&=E[Z_{n}X_{n+1}|Z_1,Z_2 \hdots Z_n]\\
&=Z_nE[X_{n+1}|Z_1,Z_2 \hdots Z_n]\\
&=Z_nE[X_{n+1}]\\
&=Z_n.
\end{flalign*} 
\end{exmp}
\begin{exmp}
Let $\{X_n\}$ be a branching process. Let $X_0=1$. Then,
\begin{equation*}
X_n = \sum_{i=1}^{X_{n-1}}Z_i,
\end{equation*}
where $Z_i$ represents the number of offspring of the $i^{\text{th}}$ individual of the $(n-1)^{\text{st}}$ generation. conditioning on $X_{n-1}$ yields, $E[X_n]= \mu^n$ where $\mu$ is the mean number of offspring per individual. Then $Y_n$ is a martingale when 
\begin{equation*}
Y_n =X_n / \mu^n.
\end{equation*}
This is true because $E[Y_n]= 1$ and 
\begin{flalign*}
E[Y_{n+1}|Y_1, \hdots Y_n]&= \frac{1}{\mu^{n+1}}E[X_{n+1}|Y_1, \hdots Y_n]\\
&= \frac{1}{\mu^{n+1}}E[\sum_{i=1}^{X_{n}}Z_i|Y_1, \hdots Y_n]\\
&=  \frac{1}{\mu^{n+1}}X_{n}E[Z_i]= \frac{X_n}{\mu^n}=Y_n.\\
\end{flalign*}
\end{exmp}
\begin{exmp}
Let $X,Y_1,Y_2 \hdots$ be arbitrary random variables such that $E[|X|]< \infty$. Then
\begin{equation*}
Z_n =E[X|Y_1,Y_2, \hdots Y_n]
\end{equation*}
is a martingale. The integrability condition is direct to be verified.
\begin{flalign*}
E[Z_{n+1}|Y_1,Y_2, \hdots Y_n]&= E[E[X|Y_1,\hdots Y_{n+1}]|Y_1,\hdots Y_{n}]\\
&= E[X|Y_1,\hdots Y_{n}]]=Z_n.\\
\end{flalign*} 
Thus the result follows. The above martingale is called the Doob type martingale.
\end{exmp}
\begin{exmp}
For any sequence of random variables $X_1,X_2 \hdots $, the random variables $X_i-E[X_i|X_1 \hdots X_{i-1}]$ have zero mean. Define
\begin{equation*}
Z_n =\sum_{i=1}^n X_i -E[X_i|X_1,X_2, \hdots X_{i-1}] 
\end{equation*}
 is  a martingale provided $E[|Z_n|]< \infty$.  To verify the same, 
 \begin{flalign*}
E[Z_{n+1}|Z_1 \hdots Z_n]&= E[Z_n+X_n-E[X_n|X_1 \hdots X_{n-1}]]\\
&= Z_n+E[X_n-E[X_n|X_1 \hdots X_{n-1}]]=Z_n.\\
\end{flalign*}
\end{exmp}
\subsection{Stopping Times}
\begin{defn}The positive integer values, possibly infinite, random variable $N$ is said to be a random time for the process $\{Z_n\}$ if the event $\{N=n\}$ is determined by the random variables $Z_1 \hdots Z_n$. If $Pr(N < \infty)=1$, then the random time $N$ is said to be  a stopping time.  
\end{defn}
\begin{defn}
Let $N$ be a random time for the process $\{Z_n\}$. Let
\begin{eqnarray*}
\bar{Z}_n = \left\{
     \begin{array}{lr}
       Z_n & : n \leq N\\
      Z_N & : n > N.
     \end{array}
   \right.
\end{eqnarray*}
$\{\bar{Z}_n\}$ is called the stopped process.
\end{defn}
\begin{prop}
If $N$ is a random time for the martingale $\{Z_n\}$, then the stopped process $\{\bar{Z}_n\}$ is also a martingale.
\end{prop}
\begin{proof}
We claim that 
\begin{equation*}
\bar{Z}_n= \bar{Z}_{n-1}+1_{N \geq n}(Z_n-Z_{n-1})
\end{equation*}
The above equation can be directly verified by considering the two cases separately viz. 
\begin{enumerate}
\item $N \geq n$: $\bar{Z}_n=Z_n$.
\item $N < n:$ $\bar{Z}_{n-1}=\bar{Z}_{n}=Z_N$
\end{enumerate}
\begin{flalign*}
E[\bar{Z}_{n+1}|Z_1 \hdots \bar{Z}_n]&=E[\bar{Z}_{n}+1_{n \leq N}(Z_n-Z_{n-1})|Z_1 \hdots \bar{Z}_n]\\
&\stackrel{(a)}{=}\bar{Z}_{n}+1_{n \leq N} E[(Z_n-Z_{n-1})|Z_1 \hdots \bar{Z}_n]\\
&=\bar{Z}_{n},
\end{flalign*}
\end{proof}
where in $(a)$ we have used the fact that $N$ is a random time. Also, we have $E[\bar{Z}_{n}]=E[Z_1]$, for all $n$.  Now assume that $N$ is a stopping time. It is immediate 
\begin{equation*}
that \bar{Z}_n \rightarrow Z_N ~ \text{w.p}~ 1.
\end{equation*}
But  is it true that
\begin{equation*}
that E[\bar{Z}_n] \rightarrow E[Z_N] ~ \text{as n}~ \rightarrow \infty.
\end{equation*}
It so turns out that the above is true under some additional regularity constraints only. We state the following theorem without proof.
\begin{thm}
If either:
\begin{enumerate}
\item $\bar{Z}_n$ are uniformly bounded, or;
\item $N$ is bounded, or;
\item $E[N]< \infty$, and there is an $M< \infty$ such that
\begin{equation*}
E[|Z_{n+1}-Z_n||Z_1 \hdots Z_n]< M,
\end{equation*}
then $E[\bar{Z}_n]\rightarrow E[Z_N]=E[Z_1]$.
\end{enumerate}
\end{thm}
\begin{cor}
\textbf{Wald's Equation}: If $X_i,~ i \geq 1$, are independent and identically distributed \textit{iid} with $E[|X|]< \infty$ and if $N$ is a stopping time for $X_1,X_2 \hdots $ with $E[N]< \infty$, then
\begin{equation*}
E[\sum_{i=1}^{N}X_i]=E[N]E[X].
\end{equation*}
\end{cor}
\begin{proof}
Let $\mu=E[X]$. Since 
\begin{equation*}
Z_n = \sum_{i=1}^{n}(X_i-\mu)
\end{equation*}
is a martingale and hence from the previous theorem, 
\begin{equation*}
E[Z_N]=E[Z_1]=0.
\end{equation*}
But 
\begin{flalign*}
E[Z_N]&= E[\sum_{i=1}^N (X_i-\mu)]\\
&=E[\sum_{i=1}^N (X_i)-N\mu)]\\
&=E[\sum_{i=1}^N (X_i)]-E[N]\mu)].
\end{flalign*}
Observe that condition $3$  for Martingale stopping theorem to hold can be directly verified. Hence the result follows. 
\end{proof}
\section{ Submartingales, Supermartingales and the Martingale Convergence Theorem}
\begin{defn}
A stochastic process $\{Z_n,~  n \geq 1\}$ having $E[|Z_n|]< \infty$ for all $n$ is said to be a submartingale if
\begin{equation}
\label{Submartingale}
E[Z_{n+1}|Z_1 \hdots Z_n] \geq Z_n
\end{equation}
and is said to be a supermartingale if
\begin{equation}
\label{Supermartingale}
E[Z_{n+1}|Z_1 \hdots Z_n] \leq Z_n
\end{equation}
\end{defn}
From \ref{Submartingale}, for a submartingale
\begin{equation*}
E[Z_{n+1}] \geq E[Z_n]
\end{equation*}
where the inequality is reversed for a supermartingale. 
\begin{thm}
\label{Stoppingtime_theorem}
If $N$ is a stopping time for $\{Z_n,~ n\geq 1\}$ such that any one of the following sufficient conditions is satisfied:
\begin{enumerate}
\item $\bar{Z}_n$ is uniformly bounded, or;
\item $N$ is bounded, or;
\item $E[N]< \infty$, and there is an $M < \infty$ such that
\begin{equation*}
E[|Z_{n+1}-Z_n| |Z_1, \hdots Z_n]<M,
\end{equation*}
then,
\begin{eqnarray*}
E[Z_N] \geq E[Z_1] ~ \text {for a submartingale}\\
E[Z_N] \leq E[Z_1] ~ \text {for a supermartingale}.
\end{eqnarray*}
\end{enumerate}
\end{thm}
\begin{proof}
We claim that 
\begin{equation*}
\bar{Z}_n= \bar{Z}_{n-1}+1_{N \geq n}(Z_n-Z_{n-1})
\end{equation*}
The above equation can be directly verified by considering the two cases separately viz. 
\begin{enumerate}
\item $N \geq n$: $\bar{Z}_n=Z_n$.
\item $N < n:$ $\bar{Z}_{n-1}=\bar{Z}_{n}=Z_N$
\end{enumerate}
\begin{flalign*}
E[\bar{Z}_{n+1}|Z_1 \hdots \bar{Z}_n]&=E[\bar{Z}_{n}+1_{n \leq N}(Z_n-Z_{n-1})|Z_1 \hdots \bar{Z}_n]\\
&\stackrel{(a)}{=}\bar{Z}_{n}+1_{n \leq N} E[(Z_n-Z_{n-1})|Z_1 \hdots \bar{Z}_n]\\
& \geq \bar{Z}_{n},
\end{flalign*}
where in $(a)$ we have used the fact that $N$ is a random time. Also, we have $E[\bar{Z}_{n}]=E[Z_1]$, for all $n$.  Now assume that $N$ is a stopping time. It is immediate that
\begin{equation*}
 \bar{Z}_n \rightarrow Z_N ~ \text{w.p}~ 1.
\end{equation*}
But  is it true that
\begin{equation*}
 E[\bar{Z}_n] \rightarrow E[Z_N] ~ \text{as n}~ \rightarrow \infty.
\end{equation*}
which gives that 
\begin{equation*}
E[Z_N ] \geq E[Z_1].
\end{equation*}
\end{proof}

Before we state and prove martingale convergence theorem, we state some results which will be used in the proof of the theorem.
\begin{lem}
\label{StoppingTimeBound}
If ${Z_i,~i\geq 1}$ is  a submartingale and $N$ is a stopping time such that $P(N \leq n)=1$ then
\begin{equation*}
 E[Z_1] \leq E[Z_N] \leq E[Z_n].
\end{equation*}
\end{lem}
\begin{proof}
It follows from Theorem \ref{Stoppingtime_theorem} that since $N$ is bounded, $E[Z_N] \geq E[Z_1]$. Now, 
\begin{eqnarray*}
E[Z_n|Z_1, \hdots ,Z_N,N=k]&=E[Z_n|Z_1 \hdots Z_k,N=k]\\
&\stackrel{(a)}{=}E[Z_n|Z_1 \hdots Z_k]\\
&=Z_k\\
&=Z_N.
\end{eqnarray*}
where $(a)$ follows from the fact that $N$ is  a stopping time. Result follows by taking expectation on both sides.
\end{proof}
\begin{lem}
\label{ConvexFuncSubmart}
If $\{Z_n,n \geq 1\}$ is a martingale and $f$ is a convex function, then $\{f(Z_n),n \geq 1\}$ is a submartigale.
\end{lem}
\begin{proof}
The result is a direct consequence of Jensen's inequality.
\begin{eqnarray*}
E[f(Z_n)|Z_1, \hdots Z_n] &\geq f(E[Z_{n+1}|Z_1, \hdots Z_n])
&=f(Z_n).
\end{eqnarray*}
\end{proof}
\begin{thm}
\textbf{(Kolmogorov's Inequality for Submartingales)}If $\{Z_n,~ n \geq 1\}$ is a martingale, then
\begin{equation*}
Pr(\max\{Z_1,Z_2 \hdots Z_n\}>a)\leq \frac{E[Z_n]}{a},~ \text{for}~ a>0.
\end{equation*}
\end{thm}
\begin{proof}
Let $N$ be the smallest value of $i$,~ $i \leq n$, such that $Z_i >a$, and define it to equal $n$ if $Z_i \leq a$ for all $i=1, \hdots n$. Note that $\max\{Z_1 \hdots Z_n\}>a$ is equivalent to $Z_N>a$. Therefore,
\begin{eqnarray*}
Pr(\max\{Z_1 \hdots Z_n\}>a)&=Pr(Z_N>a)\\
&\stackrel{(*)}{\leq} \frac{E[Z_N]}{a}\\
&\leq  \frac{E[Z_n]}{a},
\end{eqnarray*}
where the last inequality follows from Lemma \ref{StoppingTimeBound} as $N \leq n$ and $(*)$ follows from Markov's inequality.
\end{proof}
\begin{cor}
\label{MartingaleBoundCor}
Let $\{Z_n,~n \geq 1\}$ be a martingale. Then, for $a>0$:
\begin{enumerate}
\item $Pr(\max\{|Z_1|, \hdots |Z_n|>a\}) \leq E[|Z_n|]/a$;
\item $Pr(\max\{|Z_1|, \hdots |Z_n|>a\}) \leq E[Z_n^2]/a^2$.
\end{enumerate} 
\end{cor}
\begin{proof}
The proof the above statements follow from Lemma \ref{ConvexFuncSubmart} and Kolmogorov's inequality for submartingales by considering the convex functions $f(x)=|x|$ and $f(x)=x^2$. 
\end{proof}
\begin{thm}[Martingale Convergence Theorem]
\label{MartingaleConvergenceTheorem}
If $\{Z_n,~n \geq 1\}$ is a martingale such that for some $M< \infty$
\begin{equation*}
E[|Z_n|] \leq M, ~ \text{for all}~ n
\end{equation*}
then, with probability 1, $\lim_{n \rightarrow \infty}Z_n$ exists and is finite.
\end{thm}
\begin{proof}
Assume $E[Z_n^2]< \infty$ which is stronger than $E[|Z_n|]< \infty$ (as a consequence of Jensen's inequality). Observe that $\{Z_n^2\}$ is a submartingale (from Lemma \ref{ConvexFuncSubmart}). Thus $E[Z_n^2]<\infty$ and is non-decreasing in $n$. Thus, as $n \rightarrow \infty$, $E[Z_n^2]$ converges and let $\mu<\infty$ be given by $\mu=\lim_{n \rightarrow \infty}E[Z_n^2]$.
\begin{equation}
\label{KolmoBound}
Pr(\cup_{k \leq n} \{|Z_{m+k}-Z_m|> \epsilon\} )
\end{equation}  
\begin{eqnarray*}
&\stackrel{(a)}{\leq }E[(Z_{m+n}-Z_m)^2]/\epsilon^2
&=E[Z_{m+n}^2-2Z_mZ_{m+n}+Z_m^2]/\epsilon^2.
\end{eqnarray*}
Note that 
\begin{eqnarray*}
E[Z_{m+n}Z_m]&=E[E[Z_mZ_{m+n}|Z_m]]\\
&=E[Z_mE[Z_{m+n}|Z_m]]\\
&=E[Z_m^2].
\end{eqnarray*}
From \ref{KolmoBound}, 
\begin{equation*}
Pr(\cup_{k \leq n} \{|Z_{m+k}-Z_m|> \epsilon\}) \leq \frac{E[Z_{m+n}^2]-E[Z_m^2]}{\epsilon^2}.
\end{equation*}
Letting $n \rightarrow \infty$
\begin{equation*}
Pr(\cup_{k \leq 1} \{|Z_{m+k}-Z_m|> \epsilon\}) \leq \frac{\mu-E[Z_m^2]}{\epsilon^2}.
\end{equation*}
Hence,
\begin{equation*}
Pr(\cup_{k \leq n} \{|Z_{m+k}-Z_m|> \epsilon\}) \rightarrow 0 ~\text{as}~ m \rightarrow \infty.
\end{equation*}
Thus with probability 1, $\{Z_n\}$ will be  a Cauchy sequence, and thus $\lim_{n \rightarrow \infty}Z_n$ will exist and be finite.`
\end{proof}
\begin{cor}
If $\{Z_n,~m \geq 0\}$ is a non-negative martingale, then, with probability 1, $\lim_{n \rightarrow \infty}Z_n$ exists and is finite.
\end{cor}
\begin{proof}
Since $Z_n$ is non-negative,
\begin{equation*}
E[|Z_n|]=E[Z_n]=E[Z_1].
\end{equation*}
\end{proof}

\end{document}